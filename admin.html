<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Satsang 2026 | Strategic Command Center</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --maroon: #800000;
            --maroon-light: #a52a2a;
            --gold: #d4af37;
            --dark-navy: #0f172a;
            --slate-bg: #f8fafc;
            --slate-border: #e2e8f0;
            --success-green: #10b981;
            --warning-amber: #f59e0b;
            --danger-red: #ef4444;
            --sidebar-width: 280px;
        }

        /* --- GLOBAL RESET & LAYOUT --- */
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--slate-bg);
            margin: 0;
            display: flex;
            color: var(--dark-navy);
            height: 100vh;
            overflow: hidden;
        }

        /* --- MOBILE HEADER --- */
        .mobile-top-bar {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: var(--dark-navy);
            z-index: 2000;
            padding: 0 20px;
            align-items: center;
            justify-content: space-between;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* --- SIDEBAR ARCHITECTURE --- */
        .sidebar-wrapper {
            width: var(--sidebar-width);
            background: var(--dark-navy);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 40px 24px;
            box-sizing: border-box;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 10px 0 30px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .brand-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 50px;
            padding-left: 10px;
        }

        .brand-container i {
            font-size: 2.2rem;
            color: var(--gold);
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3));
        }

        .brand-container h2 {
            font-size: 1.3rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -1px;
        }

        .brand-container span { color: var(--gold); }

        .nav-list { flex: 1; list-style: none; padding: 0; margin: 0; }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
            padding: 16px 20px;
            margin-bottom: 12px;
            border-radius: 16px;
            border: none;
            background: transparent;
            color: #94a3b8;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s all;
            text-align: left;
        }

        .nav-btn i { font-size: 1.3rem; }

        .nav-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-btn.active {
            background: var(--maroon);
            color: white;
            box-shadow: 0 10px 20px rgba(128, 0, 0, 0.3);
        }

        /* Specialized Logout Button Styling */
        .nav-btn.logout {
            margin-top: 20px;
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .nav-btn.logout:hover {
            background: var(--danger-red);
            color: white;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            text-align: center;
        }

        #digital-clock {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 1px;
        }

        /* --- MAIN VIEWPORT --- */
        .viewport {
            flex: 1;
            padding: 40px 60px;
            overflow-y: auto;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        .page-content { display: none; animation: fadeIn 0.5s ease; }
        .page-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HEADER STYLING --- */
        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 45px;
        }

        .view-header h1 {
            margin: 0;
            font-size: 2.4rem;
            font-weight: 800;
            letter-spacing: -2px;
            color: var(--dark-navy);
        }

        .view-header p {
            margin: 8px 0 0;
            color: #64748b;
            font-weight: 500;
            font-size: 1.05rem;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid var(--slate-border);
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--success-green);
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .dot-pulse {
            width: 8px;
            height: 8px;
            background: var(--success-green);
            border-radius: 50%;
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        /* --- ANALYTICS CARDS & GRIDS --- */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: white;
            padding: 30px;
            border-radius: 28px;
            border: 1px solid var(--slate-border);
            box-shadow: 0 10px 20px rgba(0,0,0,0.02);
            transition: transform 0.3s;
        }

        .metric-card h4 {
            margin: 0;
            font-size: 0.8rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .metric-card .value {
            display: block;
            font-size: 2.2rem;
            font-weight: 800;
            margin: 15px 0 10px;
            color: var(--dark-navy);
        }

        .metric-card .subtitle {
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
        }

        /* --- CHARTS ROW --- */
        .charts-row {
            display: grid;
            grid-template-columns: 1.6fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .canvas-card {
            background: white;
            padding: 35px;
            border-radius: 32px;
            border: 1px solid var(--slate-border);
            height: 450px;
            box-sizing: border-box;
            position: relative;
        }

        .canvas-card h3 {
            margin: 0 0 30px 0;
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--dark-navy);
        }

        /* --- DATA TABLES & WRAPPERS --- */
        .table-wrapper {
            background: white;
            border-radius: 32px;
            border: 1px solid var(--slate-border);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.03);
            margin-bottom: 50px;
        }

        .table-toolbar {
            padding: 30px 40px;
            background: #fcfcfd;
            border-bottom: 1px solid var(--slate-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-box {
            position: relative;
            width: 350px;
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border-radius: 16px;
            border: 1.5px solid var(--slate-border);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            outline: none;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: var(--maroon);
            box-shadow: 0 0 0 4px rgba(128, 0, 0, 0.05);
        }

        .responsive-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table { width: 100%; border-collapse: collapse; min-width: 800px; }

        th {
            padding: 20px 40px;
            text-align: left;
            background: #f8fafc;
            color: #64748b;
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--slate-border);
            position: sticky;
            top: 0;
            z-index: 5;
        }

        td {
            padding: 22px 40px;
            font-size: 0.95rem;
            font-weight: 600;
            border-bottom: 1px solid #f1f5f9;
        }

        tr:hover td { background: #fdfdfd; }

        .badge {
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-filled { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-pending { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }

        /* --- RESPONSIVE --- */
        @media (max-width: 1024px) {
            .metric-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-row { grid-template-columns: 1fr; }
            .viewport { padding: 40px 30px; }
        }

        @media (max-width: 768px) {
            .mobile-top-bar { display: flex; }
            .sidebar-wrapper {
                position: fixed;
                left: 0; top: 0; bottom: 0;
                transform: translateX(-100%);
                z-index: 2100;
            }
            .sidebar-wrapper.open { transform: translateX(0); }
            .sidebar-overlay {
                display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2050;
            }
            .sidebar-overlay.active { display: block; }
            .viewport { padding: 80px 20px 40px; }
            .metric-grid { grid-template-columns: 1fr; }
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--slate-bg); }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    </style>
</head>
<body>

    <div class="mobile-top-bar">
        <span style="font-weight: 800; letter-spacing: -0.5px;">SATSANG STRATEGY</span>
        <button onclick="toggleMobileSidebar()" style="background:none; border:none; color:white; font-size: 1.8rem;">
            <i class="bi bi-list"></i>
        </button>
    </div>
    <div class="sidebar-overlay" id="overlay" onclick="toggleMobileSidebar()"></div>

    <aside class="sidebar-wrapper" id="main-sidebar">
        <div class="brand-container">
            <i class="bi bi-rocket-takeoff-fill"></i>
            <h2>DASHBOARD <span>
        </div>

        <nav class="nav-list">
            <button class="nav-btn active" id="nav-dash" onclick="navigate('dashboard', this)">
                <i class="bi bi-grid-1x2-fill"></i>
                <span>Executive Overview</span>
            </button>
            <button class="nav-btn" id="nav-matrix" onclick="navigate('matrix', this)">
                <i class="bi bi-calendar3-range-fill"></i>
                <span>Audit Matrix</span>
            </button>
            <button class="nav-btn" onclick="window.location.reload()">
                <i class="bi bi-arrow-repeat"></i>
                <span>Force Refresh</span>
            </button>

            <button class="nav-btn logout" onclick="adminLogout()">
                <i class="bi bi-box-arrow-left"></i>
                <span>Exit Dashboard</span>
            </button>
        </nav>

        <div class="sidebar-footer">
            <div id="digital-clock">00:00:00</div>
            <div style="font-size: 0.7rem; color: #64748b; margin-top: 5px; font-weight: 700;">LIVE SYSTEM MONITOR</div>
        </div>
    </aside>

    <main class="viewport">
        <section id="dashboard-view" class="page-content active">
            <header class="view-header">
                <div>
                    <h1>Executive Dashboard</h1>
                    <p>Logistics Analysis Â· March 2026 Programme</p>
                </div>
                <div class="status-pill">
                    <div class="dot-pulse"></div>
                    <span id="sync-text">ESTABLISHING CONNECTION...</span>
                </div>
            </header>

            <div class="metric-grid">
                <div class="metric-card">
                    <h4>Overall Readiness</h4>
                    <span class="value" id="stat-readiness">0%</span>
                    <div class="subtitle">Module Completion Rate</div>
                </div>
                <div class="metric-card">
                    <h4>Strategic Syncs</h4>
                    <span class="value" id="stat-syncs">0</span>
                    <div class="subtitle">Valid Data Submissions</div>
                </div>
                <div class="metric-card">
                    <h4>Fully Completed</h4>
                    <span class="value" id="stat-full">0</span>
                    <div class="subtitle">Depts with 4/4 Modules</div>
                </div>
                <div class="metric-card" style="border-bottom: 4px solid var(--warning-amber);">
                    <h4>Lagging Module</h4>
                    <span class="value" id="stat-lag" style="color: var(--warning-amber); font-size: 1.8rem;">---</span>
                    <div class="subtitle">Attention Required</div>
                </div>
            </div>

            <div class="charts-row">
                <div class="canvas-card">
                    <h3>Sub-Category Penetration</h3>
                    <div style="position: relative; height: 320px; width: 100%;">
                        <canvas id="barChartMain"></canvas>
                    </div>
                </div>
                <div class="canvas-card">
                    <h3>Module Distribution</h3>
                    <div style="position: relative; height: 320px; width: 100%;">
                        <canvas id="polarChartMain"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="matrix-view" class="page-content">
            <header class="view-header">
                <div>
                    <h1>Audit Matrix</h1>
                    <p>Submission Integrity Tracking</p>
                </div>
            </header>

            <div class="table-wrapper">
                <div class="table-toolbar">
                    <h3 style="margin:0; font-size: 1.1rem; font-weight: 800;">Department Status Checklist</h3>
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" id="matrixSearch" placeholder="Search department name..." onkeyup="filterAuditTable()">
                    </div>
                </div>
                <div class="responsive-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 300px;">Department Identity</th>
                                <th>Langar</th>
                                <th>Canteen</th>
                                <th>Acco</th>
                                <th>Shamiana</th>
                            </tr>
                        </thead>
                        <tbody id="master-audit-body"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- LOGOUT LOGIC ---
        function adminLogout() {
            // Clear the login session
            sessionStorage.removeItem('mealopsUser');
            // Redirect back to the main login file
            window.location.href = "index.html"; 
        }

        const DEPARTMENTS = ["ACCOMODATION", "ACCOUNTS", "ADMINISTRATION", "PANDAL", "SHAMIANA", "SECURITY", "AUDIO - VISUAL", "B.A.V", "BAAL PATHI", "BAAL SATSANG KARTA", "BHATI STORE", "CANTEEN", "COUPONS", "ELECTRIC", "ENGINEERING", "GUEST HOUSE", "HORTICULTURE", "I.T", "I.T BASERA", "LANGAR", "LUGGAGE", "MAINTENANCE", "MEDICAL", "NAAMDAAN", "O.E", "PATHI", "PURCHASE", "RAILWAY", "RECEPTION", "SANITATION", "SATSANG KARTA", "SECURITY BASERA", "SEWA COLLECTION", "SEWA SAMITI", "TRAFFIC", "WATER"];
        
        const ENDPOINTS = {
            langar: "https://script.google.com/macros/s/AKfycbwtAiTQN77MIS-HN6dyF_iuQe4pa1WeCTOyKBUjwqhpsnoJNtyI36Df7vaoF5YlvjpaLg/exec",
            acco: "https://script.google.com/macros/s/AKfycbyVEhi7uN6N83bLtODsOQj5yP0NJX1VrXXa0HvlBAqTmmcuY5ddnNRVuBTNlau8oG_Dow/exec",
            sham: "https://script.google.com/macros/s/AKfycbyj8TBontMhVfA5PCiQDzMjE40T6lvbSP-aQSuMDaga7qI34aO-4JbUtsLOcqrBc7wh/exec",
            canteen: "https://script.google.com/macros/s/AKfycbzsGsitdepaCHSUAMW4mPSRbxaJG4BBdhgCwwHO9w_IuyT00Ht_6lWR6svkcprs7_iXHg/exec"
        };

        let chartRegistry = {};

        function toggleMobileSidebar() {
            document.getElementById('main-sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('active');
        }

        function navigate(viewId, btn) {
            document.querySelectorAll('.page-content').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewId}-view`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(window.innerWidth <= 768) toggleMobileSidebar();
            document.querySelector('.viewport').scrollTop = 0;
        }

        function filterAuditTable() {
            const input = document.getElementById("matrixSearch").value.toUpperCase();
            const rows = document.getElementById("master-audit-body").getElementsByTagName("tr");
            for (let i = 0; i < rows.length; i++) {
                const deptName = rows[i].cells[0].textContent || rows[i].cells[0].innerText;
                rows[i].style.display = deptName.toUpperCase().indexOf(input) > -1 ? "" : "none";
            }
        }

        function initCharts() {
            const barCtx = document.getElementById('barChartMain').getContext('2d');
            chartRegistry.bar = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Langar', 'Canteen', 'Acco', 'Shamiana'],
                    datasets: [{
                        label: 'Depts Submitted',
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#800000', '#d4af37', '#0f172a', '#64748b'],
                        borderRadius: 15,
                        barThickness: 'flex'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: DEPARTMENTS.length, ticks: { stepSize: 5 } } }
                }
            });

            const polarCtx = document.getElementById('polarChartMain').getContext('2d');
            chartRegistry.polar = new Chart(polarCtx, {
                type: 'polarArea',
                data: {
                    labels: ['Langar', 'Canteen', 'Acco', 'Shamiana'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['rgba(128,0,0,0.7)', 'rgba(212,175,55,0.7)', 'rgba(15,23,42,0.7)', 'rgba(100,116,139,0.7)']
                    }]
                },
                options: { maintainAspectRatio: false, responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        }

        async function fetchSystemState() {
            const syncIndicator = document.getElementById('sync-text');
            syncIndicator.innerText = "SYNCING LIVE DATA...";
            try {
                const [langarRaw, canteenRaw, accoRaw, shamRaw] = await Promise.all([
                    fetch(ENDPOINTS.langar).then(r => r.json()),
                    fetch(ENDPOINTS.canteen).then(r => r.json()),
                    fetch(ENDPOINTS.acco).then(r => r.json()),
                    fetch(ENDPOINTS.sham).then(r => r.json())
                ]);
                const state = {
                    langar: new Set(langarRaw.map(r => r[1])),
                    canteen: new Set(canteenRaw.map(r => r[1])),
                    acco: new Set(accoRaw.map(r => r[1])),
                    sham: new Set(shamRaw.map(r => r[1]))
                };
                updateAnalytics(state);
                renderAuditMatrix(state);
                syncIndicator.innerText = "LAST SYNC: " + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (err) {
                console.error("Critical Sync Fault:", err);
                syncIndicator.innerText = "SYNC FAULT - RETRYING...";
            }
        }

        function updateAnalytics(state) {
            const totalRequired = DEPARTMENTS.length * 4;
            let totalDone = 0;
            let fullyCompliant = 0;
            DEPARTMENTS.forEach(dept => {
                let score = 0;
                if(state.langar.has(dept)) score++;
                if(state.canteen.has(dept)) score++;
                if(state.acco.has(dept)) score++;
                if(state.sham.has(dept)) score++;
                totalDone += score;
                if(score === 4) fullyCompliant++;
            });
            document.getElementById('stat-readiness').innerText = Math.round((totalDone / totalRequired) * 100) + "%";
            document.getElementById('stat-syncs').innerText = totalDone;
            document.getElementById('stat-full').innerText = fullyCompliant;
            if(totalDone > 0) {
                const modules = [
                    { name: 'LANGAR', val: state.langar.size },
                    { name: 'CANTEEN', val: state.canteen.size },
                    { name: 'ACCO', val: state.acco.size },
                    { name: 'SHAMIANA', val: state.sham.size }
                ].sort((a,b) => a.val - b.val);
                document.getElementById('stat-lag').innerText = modules[0].name;
            }
            chartRegistry.bar.data.datasets[0].data = [state.langar.size, state.canteen.size, state.acco.size, state.sham.size];
            chartRegistry.bar.update();
            chartRegistry.polar.data.datasets[0].data = [state.langar.size, state.canteen.size, state.acco.size, state.sham.size];
            chartRegistry.polar.update();
        }

        function renderAuditMatrix(state) {
            const body = document.getElementById('master-audit-body');
            body.innerHTML = DEPARTMENTS.map(dept => `
                <tr>
                    <td style="color: var(--maroon); font-weight: 800;">${dept}</td>
                    <td>${state.langar.has(dept) ? '<span class="badge badge-filled">DONE</span>' : '<span class="badge badge-pending">WAIT</span>'}</td>
                    <td>${state.canteen.has(dept) ? '<span class="badge badge-filled">DONE</span>' : '<span class="badge badge-pending">WAIT</span>'}</td>
                    <td>${state.acco.has(dept) ? '<span class="badge badge-filled">DONE</span>' : '<span class="badge badge-pending">WAIT</span>'}</td>
                    <td>${state.sham.has(dept) ? '<span class="badge badge-filled">DONE</span>' : '<span class="badge badge-pending">WAIT</span>'}</td>
                </tr>
            `).join('');
        }

        setInterval(() => {
            const clock = document.getElementById('digital-clock');
            if(clock) clock.innerText = new Date().toLocaleTimeString();
        }, 1000);

        window.onload = () => {
            initCharts();
            fetchSystemState();
            setInterval(fetchSystemState, 5000); 
        };
    </script>
</body>
</html>